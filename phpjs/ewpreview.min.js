/**
 * Detail Preview Extension
 * @license (C) 2017 e.World Technology Ltd.
 */
function ew_AddRowToTable(e){var t,a,o=jQuery,i=o(e),n=0,r=i.closest("tbody");EW_PREVIEW_SINGLE_ROW&&r.find("tr."+EW_TABLE_PREVIEW_ROW_CLASSNAME).remove(),o(e.cells).each(function(){n+=this.colSpan});var d=i.nextAll("tr[data-rowindex!="+i.data("rowindex")+"]").first();return d.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)?d[0]:((t=r[0].insertRow(d[0]?d[0].sectionRowIndex:-1))&&(o(t).addClass(EW_TABLE_PREVIEW_ROW_CLASSNAME),a=o(t.insertCell(0)).addClass(EW_TABLE_LAST_COL_CLASSNAME).prop("colSpan",n)),t)}function ew_ShowDetails(e){var t=jQuery,a=t(this),o=a.is("tr[data-rowindex]"),i=o?a:a.closest("tr[data-rowindex]"),n=i.closest("table");if(i[0]){if(i.data("preview")){var r=i.nextAll("tr[data-rowindex!='"+i.data("rowindex")+"']").first();r.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)&&r.remove(),i.data("preview",!1).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-expand").removeClass("icon-collapse")}else{var d=ew_AddRowToTable(i[0]),s=t(d.cells[0]),l=i.find("[class$=_preview] div.ewPreview");s.empty(),s.append(t("#ewPreview").contents().clone()).find(".nav-tabs").append(l.find("li:has([data-toggle='tab'])").clone(!0)).find("[data-toggle='tab']").attr("data-target","#"+s.find(".tab-pane").attr("id",ew_Random()).attr("id")).first().tab("show"),(EW_PREVIEW_SINGLE_ROW?n:i).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-expand").removeClass("icon-collapse"),i.data("preview",!0).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-collapse").removeClass("icon-expand")}ew_SetupTable(-1,n[0],!0)}}function ew_Detail(e,t){var a=jQuery,o=a(t),i=o.closest(".ewListOptionBody"),n=o.data("placement")||EW_PREVIEW_PLACEMENT,r=i.find(".dropdown-menu"),d=i.find(".btn-group");r.mouseenter(function(e){e.stopPropagation()}),d[0]&&("right"==n&&r.addClass("pull-right"),o=d),o.data("bs.popover")||o.popover({html:!0,delay:{show:100,hide:250},placement:n,trigger:"hover",container:a("#ewTooltip")[0],content:EW_LOADING_HTML}).on("show.bs.popover",function(e){a(".popover.ewPreviewOverlay").hide(),o.data("bs.popover").tip().css("opacity",0)}).on("shown.bs.popover",function(e){var t=o.data("bs.popover").tip().css({"min-width":"200px","max-width":"1000px"});t.find(".popover-content").html(a("#ewPreview").html()),t.find(".nav-tabs").append(i.find("li:has([data-toggle='tab'])").clone(!0)),t.find("[data-toggle='tab']").attr("data-target","#"+t.find(".tab-pane").attr("id",ew_Random()).attr("id")).data("$element",o).first().tab("show"),ew_MoveTip(o),t.fadeTo(0,1).addClass("ewPreviewOverlay")}).data("bs.popover").tip().mouseenter(function(e){clearTimeout(o.data("bs.popover").timeout)}).mouseleave(function(e){var t=o.data("bs.popover");t.tip().html().indexOf(EW_LOADING_HTML)>-1||(t.timeout=setTimeout(function(){t.hide.call(t)},t.options.delay.hide))})}function ew_MoveTip(e){var t=jQuery,a=e.data("placement")||EW_PREVIEW_PLACEMENT;if("left"==a||"right"==a){var o=t(document),i=t(document.body),n=e.data("bs.popover").tip(),r=(n.width(),n.offset()),d=e.parent();bottom=o.scrollTop()+i.outerHeight()-n.outerHeight(),d.hasClass("btn-group")&&(e=d,d=e.parent());var s=e.offset();r.top=s.top+e.height()/2-n.height()/2,r.top=Math.max(o.scrollTop(),Math.min(bottom,r.top)),n.css("top",r.top+"px"),"right"==a&&e.is(".btn-group")&&n.css("left",s.left+e.width());var l=n.find(".arrow");"left"==a&&(left=s.left-n.outerWidth()-l.width(),n.css("left",left));var p=s.top-r.top+e.height()/2-l.height(),w=(parseInt(n.css("border-top-left-radius"),10)||6)-parseInt(l.css("margin-top"),10),c=n.height()-w-l.height();l.css("top",Math.max(w,Math.min(p,c))+"px")}}function ew_TabShow(e){var t=jQuery,a=t(e.target),o=a.data("url"),i=a.data("table"),n=t(a.attr("data-target"));o&&n[0]&&(n.empty().html(EW_LOADING_HTML),t.get(o,function(e){n.empty().html(e).append(t("div[data-table='"+i+"'][data-url='"+o+"']:first").clone()),t(document).trigger("preview",[{$tabpane:n}]),a.data("$element")&&ew_MoveTip(a.data("$element"))}))}function ew_Preview(e,t){var a=t.$tabpane;a.find("table."+EW_TABLE_CLASSNAME).each(ew_SetupTable),ew_InitIcons(),a.find("a.ewTooltipLink").each(ew_Tooltip),$(".ewLightbox").each(function(){var e=$(this);e.colorbox($.extend({rel:e.data("rel")},ewLightboxSettings))})}var EW_LOADING_HTML="<div class='ewSpinner'><div></div></div> "+ewLanguage.Phrase("Loading"),EW_PREVIEW_BUTTON_SELECTOR=".ewPreviewRowBtn";jQuery(document).on("preview",ew_Preview),jQuery(function(e){EW_PREVIEW_OVERLAY&&e("div.ewPreview").each(function(){e(this).parent().find("[data-action='view'],[data-action='list']").each(ew_Detail)}),e(EW_PREVIEW_BUTTON_SELECTOR).click(ew_ShowDetails),e("div.ewPreview [data-toggle='tab']").on("show.bs.tab",ew_TabShow)});